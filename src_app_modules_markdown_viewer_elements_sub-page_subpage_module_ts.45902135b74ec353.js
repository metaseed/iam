"use strict";(self.webpackChunkiam=self.webpackChunkiam||[]).push([["src_app_modules_markdown_viewer_elements_sub-page_subpage_module_ts"],{8936:(rt,T,i)=>{i.r(T),i.d(T,{SubPageModule:()=>it});var h=i(6903),p=i(5624),f=i(6681),I=i(3550),Z=i(2518),C=i(8733),S=i(9592);function y(o,u){return(0,C.e)(function(o,u,e){return(r,a)=>{let s=0;r.subscribe(new S.Q(a,c=>{const l=s++;o.call(u,c,l,r)&&(a.next(c),a.complete())},()=>{a.next(void 0),a.complete()}))}}(o,u))}var N=i(7634),J=i(3369),U=i(4402),F=i(5992),$=i(3826);const B=(0,F.d)(o=>function(e=null){o(this),this.message="Timeout has occurred",this.name="TimeoutError",this.info=e});function x(o,u){const{first:e,each:n,with:r=z,scheduler:a=(null!=u?u:N.z),meta:s=null}=(0,J.q)(o)?{first:o}:"number"==typeof o?{each:o}:o;if(null==e&&null==n)throw new TypeError("No timeout provided.");return(0,C.e)((c,l)=>{let m,d,g=null,k=0;const O=P=>{d=(0,$.f)(l,a,()=>{try{m.unsubscribe(),(0,U.Xf)(r({meta:s,lastValue:g,seen:k})).subscribe(l)}catch(st){l.error(st)}},P)};m=c.subscribe(new S.Q(l,P=>{null==d||d.unsubscribe(),k++,l.next(g=P),n>0&&O(n)},void 0,void 0,()=>{(null==d?void 0:d.closed)||null==d||d.unsubscribe(),g=null})),O(null!=e?"number"==typeof e?e:+e-a.now():n)})}function z(o){throw new B(o)}var Y=i(6084),H=i(6122),A=i(6456),j=i(6145),L=i(6251),t=i(8079),E=i(1935),q=i(1180);let Q=(()=>{class o{constructor(e){this.dialog=e}onClick(e){this.dialog.close(e)}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(E.so))},o.\u0275cmp=t.Xpm({type:o,selectors:[["subpage-id-search"]],decls:1,vars:0,consts:[[3,"onClick"]],template:function(e,n){1&e&&(t.TgZ(0,"doc-search-list",0),t.NdJ("onClick",function(a){return n.onClick(a)}),t.qZA())},directives:[q.I],encapsulation:2}),o})();var M=i(9597),w=i(4060),K=i(3863),X=i(8513),V=i(7826),b=i(5682),G=i(3860),v=i(9819),R=i(7394),W=i(6134),_=i(7733);function tt(o,u){if(1&o&&(t.TgZ(0,"span",23),t._uU(1),t.qZA()),2&o){const e=t.oxw().$implicit;t.xp6(1),t.hij(" v",e.version," ")}}function et(o,u){if(1&o){const e=t.EpF();t.TgZ(0,"div",16),t.TgZ(1,"div",17),t.NdJ("click",function(){const a=t.CHM(e).$implicit;return t.oxw().onShowDoc(a)}),t.TgZ(2,"section"),t._uU(3),t.qZA(),t.TgZ(4,"span",18),t._uU(5),t.qZA(),t.TgZ(6,"p"),t._uU(7),t.qZA(),t.qZA(),t.TgZ(8,"p",19),t.TgZ(9,"button",20),t.NdJ("click",function(){const a=t.CHM(e).$implicit;return t.oxw().delete(a)}),t.TgZ(10,"mat-icon"),t._uU(11,"delete_forever"),t.qZA(),t.qZA(),t.YNc(12,tt,2,1,"span",21),t.TgZ(13,"span",22),t._uU(14),t.qZA(),t.qZA(),t.qZA()}if(2&o){const e=u.$implicit;t.xp6(3),t.Oqu(e.title),t.xp6(2),t.Oqu(e.id),t.xp6(2),t.Oqu(e.summary),t.xp6(5),t.Q6J("ngIf",e.version),t.xp6(2),t.AsE("",null==e.createDate?null:e.createDate.toLocaleDateString()," - ",e.updateDate.toLocaleDateString(),"")}}let nt=(()=>{class o extends((0,p.P2)(j.z)){constructor(e,n,r,a,s,c){super(n,a),this.router=e,this.store=n,this.documentEffects=r,this.dialog=s,this.snackbar=c,this.isPanelOpen=!1,this.subPagesChanged=!1,this.onPanelOpen=(()=>{let l;return()=>{if(this.isPanelOpen=!0,!this.subPagesChanged)return;this.subPagesChanged=!1,this.removeSub(l),l=this.addObs(this.store.docMetasOfIds$(this.ids).pipe((0,f.U)(d=>d.filter(g=>!!g)),(0,I.b)(300),(0,Z.b)(d=>this.pageList=d)));const{ids:m}=this;m.length>0&&this.documentEffects.readDocMetas_.next({ids:m})}})(),this.ids=[],this.pageList=[]}set pages(e){this.ids=JSON.parse(e),this.subPagesChanged=!0,this.isPanelOpen&&this.onPanelOpen()}delete(e){const n=this.ids.indexOf(e.id);if(-1!==n)return this.ids.splice(n,1),this.subPagesChanged=!0,this.source=`subPage: [${this.ids}]`,void(this.isPanelOpen&&this.onPanelOpen());this.logger.debug("SubPageComponent.delete: id not found")}addToParentById(e,n){e=+e,this.addSub(this.documentEffects.readDocument_.operationStatus$.pipe(y(a=>a.step===M.m7.Complete&&a.trigger.id===e),x(p.j1),(0,f.U)(()=>{const a=this.store.docContent.currentId_.state,s=this.store.getDocContent(e).content;let c=(0,p.Nn)(s);if(c||(c=(0,p.Eq)()),c.subPage||(c.subPage=[]),c.subPage.includes(a))return void this.snackbar.open("parent doc already has this document as a subpage","ok");c.subPage.push(a);const l=this.store.getDocMeta(e);l.subPage=c.subPage;const m=(0,p.$j)(s,c);this.logger.debug(`try to save parent doc content after add this page as subpage of parent doc: ${e}...`),this.documentEffects.saveDocument_.operationStatus$.pipe(y(d=>d.step===M.m7.Success&&d.trigger.id===e),x(p.j1),(0,Z.b)(d=>{this.snackbar.open(`added to page(id: ${e}) as a subpage.`,"ok")})).subscribe(),this.documentEffects.saveDocument_.next({id:e,content:m,format:p.cZ[l.format]})}),(0,Y.K)(a=>"TimeoutError"===a.name?(this.logger.error(a),this.snackbar.open("this document not added to parent, because of timeout","ok"),A.E):(this.snackbar.open("this document not added to parent, because error happens","ok"),A.E))));const r=this.store.getDocMeta(e);this.documentEffects.readDocument_.next({id:e,format:null==r?void 0:r.format})}addId(e,n){this.ids.includes(e=+e)?this.snackbar.open(`id ${e} already included`,"ok"):(this.ids.push(e),this.subPagesChanged=!0,this.source=`subPage: [${this.ids}]`,n&&(n.value=null))}addToParentBySearch(){this.searchDoc().subscribe(e=>this.addToParentById(e))}addIdBySearch(){this.searchDoc().subscribe(e=>this.addId(e))}searchDoc(){return this.dialog.open(Q,{width:"95vw",height:"90vh"}).afterClosed().pipe((0,f.U)(n=>null==n?void 0:n.id),(0,H.h)(n=>!!n))}onShowDoc(e){this.router.navigate(["/doc"],{queryParams:{id:e.id,title:e.title,f:e.format||"md"}})}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(w.F0),t.Y36(K.G),t.Y36(L.CL),t.Y36(X.d),t.Y36(E.uw),t.Y36(V.ux))},o.\u0275cmp=t.Xpm({type:o,selectors:[["i-subpage"]],inputs:{pages:"pages"},features:[t.qOj],decls:33,vars:3,consts:[[2,"background-color","transparent","box-shadow","none",3,"opened","closed"],[1,"action-group",3,"click"],["mat-button","","aria-label","add this page as subpage","title","add this page as a subpage to another page",2,"background-color","transparent",3,"matMenuTriggerFor"],[2,"color","#000a"],["menu","matMenu"],[1,"id-input-group",2,"height","auto","border","none",3,"click"],["placeholder","parent page id","matInput","","type","number",1,"id-input",2,"width","auto","margin-left","0.8rem",3,"keydown.Enter","keyup.Enter"],["input",""],["matSuffix","","mat-button","","aria-label","add with parent page id",3,"click"],["mat-menu-item","",3,"click"],[1,"id-input-group"],["placeholder","add by id","matInput","","type","number",1,"id-input",3,"keydown.Enter","keyup.Enter"],["matSuffix","","mat-icon-button","","aria-label","add id",3,"click"],["title","add subpage by searching","mat-button","",3,"click"],[1,"card-container"],["class","docs-card",4,"ngFor","ngForOf"],[1,"docs-card"],[1,"card-body",3,"click"],[1,"doc-id"],[1,"meta-version-date","card-footer"],["mat-button","",1,"delete-button",3,"click"],["class","meta-version",4,"ngIf"],[1,"meta-date",2,"margin-left","10px"],[1,"meta-version"]],template:function(e,n){if(1&e){const r=t.EpF();t.TgZ(0,"mat-expansion-panel",0),t.NdJ("opened",function(){return n.onPanelOpen()})("closed",function(){return n.isPanelOpen=!1}),t.TgZ(1,"mat-expansion-panel-header"),t.TgZ(2,"mat-panel-title"),t._uU(3),t.qZA(),t.TgZ(4,"div",1),t.NdJ("click",function(s){return s.stopImmediatePropagation()}),t.TgZ(5,"button",2),t.TgZ(6,"mat-icon",3),t._uU(7,"dashboard_customize"),t.qZA(),t._uU(8,"add as subpage "),t.qZA(),t.TgZ(9,"mat-menu",null,4),t.TgZ(11,"div",5),t.NdJ("click",function(s){return s.stopImmediatePropagation()}),t.TgZ(12,"input",6,7),t.NdJ("keydown.Enter",function(s){return s.stopPropagation()})("keyup.Enter",function(){t.CHM(r);const s=t.MAs(13);return n.addToParentById(s.value,s)}),t.qZA(),t.TgZ(14,"button",8),t.NdJ("click",function(){t.CHM(r);const s=t.MAs(13);return n.addToParentById(s.value,s)}),t.TgZ(15,"mat-icon"),t._uU(16,"add"),t.qZA(),t.qZA(),t.qZA(),t.TgZ(17,"button",9),t.NdJ("click",function(){return n.addToParentBySearch()}),t.TgZ(18,"mat-icon"),t._uU(19,"saved_search"),t.qZA(),t.TgZ(20,"span"),t._uU(21,"search parent page"),t.qZA(),t.qZA(),t.qZA(),t.TgZ(22,"div",10),t.TgZ(23,"input",11,7),t.NdJ("keydown.Enter",function(s){return s.stopPropagation()})("keyup.Enter",function(){t.CHM(r);const s=t.MAs(13);return n.addId(s.value,s)}),t.qZA(),t.TgZ(25,"button",12),t.NdJ("click",function(){t.CHM(r);const s=t.MAs(13);return n.addId(s.value,s)}),t.TgZ(26,"mat-icon",3),t._uU(27,"add"),t.qZA(),t.qZA(),t.qZA(),t.TgZ(28,"button",13),t.NdJ("click",function(){return n.addIdBySearch()}),t.TgZ(29,"mat-icon",3),t._uU(30," zoom_in "),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.TgZ(31,"div",14),t.YNc(32,et,15,6,"div",15),t.qZA(),t.qZA()}if(2&e){const r=t.MAs(10);t.xp6(3),t.hij(" Subpages(",n.ids.length,") "),t.xp6(2),t.Q6J("matMenuTriggerFor",r),t.xp6(27),t.Q6J("ngForOf",n.pageList)}},directives:[b.ib,b.yz,b.yK,G.lW,v.p6,R.Hw,v.VK,W.Nt,_.R9,v.OP,h.sg,h.O5],styles:[".doc-id[_ngcontent-%COMP%]{position:absolute;right:1.2rem;font-size:small;top:1rem;color:gray}input[_ngcontent-%COMP%]::-webkit-outer-spin-button, input[_ngcontent-%COMP%]::-webkit-inner-spin-button{-webkit-appearance:none;margin:0}input[type=number][_ngcontent-%COMP%]{-moz-appearance:textfield}.id-input-group[_ngcontent-%COMP%]{display:flex;border:lightgray solid .1rem;padding-left:1rem;font-size:medium;height:3rem;align-items:center}.action-group[_ngcontent-%COMP%]{display:flex;align-items:center;grid-column-gap:1rem;column-gap:1rem;margin-right:1rem}.id-input[_ngcontent-%COMP%]{width:6.5rem;margin-top:.02rem}"]}),o})();var ot=i(1677),at=i(3245);let it=(()=>{class o{constructor(){this.customElementComponent=nt}}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[[h.ez,at.B,ot.t]]}),o})()}}]);