"use strict";(self.webpackChunkiam=self.webpackChunkiam||[]).push([["src_app_modules_markdown_viewer_elements_version_version_module_ts"],{7839:(O,v,n)=>{n.r(v),n.d(v,{VersionModule:()=>c});var f=n(7011),Z=n(3346),x=n(7731),S=n(4852),h=n(6828),C=n(18),t=n(5281),D=n(4164);class r{constructor(e){this.githubStorage=e}getHistory(e,o){return this.githubStorage.init().pipe((0,C.w)(a=>a.listCommits({path:`documents/${e}.${o}`})))}getHistoryVersion(e,o,a){return this.githubStorage.init().pipe((0,C.w)(i=>i.getContents(`documents/${e}.${o}`,a)))}}r.\u0275fac=function(e){return new(e||r)(t.LFG(D.SS))},r.\u0275prov=t.Yz7({token:r,factory:r.\u0275fac});var A=n(3746),H=n(4578),T=n(7102),V=n(268);function F(s,e){if(1&s){const o=t.EpF();t.TgZ(0,"a",2),t.NdJ("click",function(){const d=t.CHM(o).$implicit,u=t.oxw();return t.KtG(u.openLink(d))}),t.TgZ(1,"span",3),t._uU(2),t.qZA(),t.TgZ(3,"div",4)(4,"span"),t._uU(5),t.qZA(),t.TgZ(6,"span",5),t._uU(7),t.qZA()()()}if(2&s){const o=e.$implicit;t.xp6(2),t.Oqu(o.commit.message),t.xp6(3),t.Oqu(o.commit.committer.date),t.xp6(2),t.AsE(" ",o.commit.author.name," <",o.commit.author.email,">")}}class m{constructor(e,o,a,i){this.data=e,this.service=o,this.docStore=a,this.router=i;const{id:d,format:u}=this.data;o.getHistory(d,u).subscribe(p=>{this.docHistory_all=p,this.docHistory=this.docHistory_filtered=p.filter(g=>/, change:.*/.test(g.commit.message))})}showAllOrFiltered(e){this.docHistory=e.checked?this.docHistory_all:this.docHistory_filtered}openLink(e){this.selectedCommit=e;const o=e.sha,{id:a,format:i}=this.data;this.service.getHistoryVersion(a,i,o).subscribe(d=>{const u=new S.Sb(h.Mx,d.content,o);this.docStore.docContent.upsert(u);const p={...this.docStore.docMeta.currentEntity$.state};p.id=h.Mx,this.docStore.docMeta.upsert(p),this.docStore.docStatus.upsert({id:h.Mx,isEditable:!1}),this.router.navigate(["/doc"],{queryParams:{id:h.Mx,f:i||"md"}})})}}m.\u0275fac=function(e){return new(e||m)(t.Y36(x.OG),t.Y36(r),t.Y36(A.G),t.Y36(H.F0))},m.\u0275cmp=t.Xpm({type:m,selectors:[["document-history-list"]],features:[t._Bn([r])],decls:4,vars:1,consts:[[3,"change"],["mat-list-item","",3,"click",4,"ngFor","ngForOf"],["mat-list-item","",3,"click"],["mat-line",""],["mat-line","",2,"display","flex","justify-content","space-between","color","slategray","font-style","italic","font-size","smaller"],[2,"font-size","smaller"]],template:function(e,o){1&e&&(t.TgZ(0,"mat-slide-toggle",0),t.NdJ("change",function(i){return o.showAllOrFiltered(i)}),t._uU(1,"all"),t.qZA(),t.TgZ(2,"mat-nav-list"),t.YNc(3,F,8,4,"a",1),t.qZA()),2&e&&(t.xp6(3),t.Q6J("ngForOf",o.docHistory))},dependencies:[f.sg,T.Hk,T.Tg,V.Rr],encapsulation:2});var w=n(4785);function M(s,e){if(1&s){const o=t.EpF();t.TgZ(0,"a",4),t.NdJ("click",function(){t.CHM(o);const i=t.oxw();return t.KtG(i.onShowVersions())}),t.TgZ(1,"span"),t._uU(2),t.qZA(),t.TgZ(3,"mat-icon",5),t._uU(4,"open_in_new"),t.qZA()()}if(2&s){const o=t.oxw();t.xp6(2),t.hij("\xa0v",o.version,"")}}function Y(s,e){if(1&s&&(t.TgZ(0,"span",6),t._uU(1),t.qZA()),2&s){const o=t.oxw();t.xp6(1),t.Oqu(o.createDate)}}function L(s,e){if(1&s&&(t.TgZ(0,"span",6),t._uU(1),t.qZA()),2&s){const o=t.oxw();t.xp6(1),t.hij(" - ",o.updateDate,"")}}function _(s,e){if(1&s&&(t.TgZ(0,"span",7),t._uU(1),t.qZA()),2&s){const o=t.oxw();t.xp6(1),t.hij("\xa0 (id:",o.id,")")}}class l{constructor(e,o){this.bottomSheet=e,this.router=o,this.version="",this.createDate="",this.updateDate="",this.id="",this.format=""}ngOnInit(){const e=this.router.parseUrl(this.router.url).queryParams;this.id=e.id,this.format=e.f}onShowVersions(){this.bottomSheet.open(m,{data:{id:this.id,format:this.format}}).afterDismissed().subscribe()}}l.\u0275fac=function(e){return new(e||l)(t.Y36(x.ch),t.Y36(H.F0))},l.\u0275cmp=t.Xpm({type:l,selectors:[["i-version"]],inputs:{version:"version",createDate:"createDate",updateDate:"updateDate"},decls:5,vars:4,consts:[[1,"meta-version-date"],["class","meta-version","aria-label","show document history versions",3,"click",4,"ngIf"],["class","meta-date",4,"ngIf"],["class","meta-id",4,"ngIf"],["aria-label","show document history versions",1,"meta-version",3,"click"],[2,"font-size","small"],[1,"meta-date"],[1,"meta-id"]],template:function(e,o){1&e&&(t.TgZ(0,"div",0),t.YNc(1,M,5,1,"a",1),t.YNc(2,Y,2,1,"span",2),t.YNc(3,L,2,1,"span",2),t.YNc(4,_,2,1,"span",3),t.qZA()),2&e&&(t.xp6(1),t.Q6J("ngIf",o.version),t.xp6(1),t.Q6J("ngIf",o.createDate),t.xp6(1),t.Q6J("ngIf",o.updateDate),t.xp6(1),t.Q6J("ngIf",o.id))},dependencies:[f.O5,w.Hw],encapsulation:2});class c{constructor(){this.customElementComponent=l}}c.\u0275fac=function(e){return new(e||c)},c.\u0275mod=t.oAB({type:c}),c.\u0275inj=t.cJS({imports:[f.ez,Z.B]})}}]);