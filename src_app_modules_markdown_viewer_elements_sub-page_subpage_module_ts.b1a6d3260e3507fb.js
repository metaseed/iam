"use strict";(self.webpackChunkiam=self.webpackChunkiam||[]).push([["src_app_modules_markdown_viewer_elements_sub-page_subpage_module_ts"],{1768:(rt,y,a)=>{a.r(y),a.d(y,{SubPageModule:()=>g});var b=a(7011),m=a(4852),v=a(6801),U=a(504),Z=a(2538),x=a(8586),E=a(9230);function M(s,e){return(0,x.e)(function F(s,e,n){const r="index"===n;return(i,o)=>{let d=0;i.subscribe(new E.Q(o,l=>{const u=d++;s.call(e,l,u,i)&&(o.next(r?u:l),o.complete())},()=>{o.next(r?-1:void 0),o.complete()}))}}(s,e,"value"))}var $=a(7203),z=a(6264),B=a(4796),K=a(1606),Y=a(3933);const H=(0,K.d)(s=>function(n=null){s(this),this.message="Timeout has occurred",this.name="TimeoutError",this.info=n});function k(s,e){const{first:n,each:r,with:i=j,scheduler:o=e??$.z,meta:d=null}=(0,z.q)(s)?{first:s}:"number"==typeof s?{each:s}:s;if(null==n&&null==r)throw new TypeError("No timeout provided.");return(0,x.e)((l,u)=>{let p,c,T=null,N=0;const J=S=>{c=(0,Y.f)(u,o,()=>{try{p.unsubscribe(),(0,B.Xf)(i({meta:d,lastValue:T,seen:N})).subscribe(u)}catch(st){u.error(st)}},S)};p=l.subscribe(new E.Q(u,S=>{c?.unsubscribe(),N++,u.next(T=S),r>0&&J(r)},void 0,void 0,()=>{c?.closed||c?.unsubscribe(),T=null})),J(null!=n?"number"==typeof n?n:+n-o.now():r)})}function j(s){throw new H(s)}var G=a(8028),L=a(594),O=a(9e3),w=a(4196),Q=a(2482),t=a(5281),I=a(7938),X=a(7851);class h{constructor(e){this.dialog=e}onClick(e){this.dialog.close(e)}}h.\u0275fac=function(e){return new(e||h)(t.Y36(I.so))},h.\u0275cmp=t.Xpm({type:h,selectors:[["subpage-id-search"]],decls:1,vars:0,consts:[[3,"onClick"]],template:function(e,n){1&e&&(t.TgZ(0,"doc-search-list",0),t.NdJ("onClick",function(i){return n.onClick(i)}),t.qZA())},dependencies:[X.I],encapsulation:2});var A=a(8877),R=a(4578),V=a(3746),W=a(1956),_=a(2785),q=a(4785),P=a(1333),D=a(8894),tt=a(1938),et=a(151),C=a(2579);function nt(s,e){if(1&s&&(t.TgZ(0,"span",23),t._uU(1),t.qZA()),2&s){const n=t.oxw().$implicit;t.xp6(1),t.hij(" v",n.version," ")}}function ot(s,e){if(1&s){const n=t.EpF();t.TgZ(0,"div",16)(1,"div",17),t.NdJ("click",function(){const o=t.CHM(n).$implicit,d=t.oxw();return t.KtG(d.onShowDoc(o))}),t.TgZ(2,"section"),t._uU(3),t.qZA(),t.TgZ(4,"span",18),t._uU(5),t.qZA(),t.TgZ(6,"p"),t._uU(7),t.qZA()(),t.TgZ(8,"p",19)(9,"button",20),t.NdJ("click",function(){const o=t.CHM(n).$implicit,d=t.oxw();return t.KtG(d.delete(o))}),t.TgZ(10,"mat-icon"),t._uU(11,"delete_forever"),t.qZA()(),t.YNc(12,nt,2,1,"span",21),t.TgZ(13,"span",22),t._uU(14),t.qZA()()()}if(2&s){const n=e.$implicit;t.xp6(3),t.Oqu(n.title),t.xp6(2),t.Oqu(n.id),t.xp6(2),t.Oqu(n.summary),t.xp6(5),t.Q6J("ngIf",n.version),t.xp6(2),t.AsE("",null==n.createDate?null:n.createDate.toLocaleDateString()," - ",n.updateDate.toLocaleDateString(),"")}}class f extends((0,m.P2)(w.z)){constructor(e,n,r,i,o,d){super(n,i),this.router=e,this.store=n,this.documentEffects=r,this.dialog=o,this.snackbar=d,this.isPanelOpen=!1,this.subPagesChanged=!1,this.onPanelOpen=(()=>{let l;return()=>{if(this.isPanelOpen=!0,!this.subPagesChanged)return;this.subPagesChanged=!1,this.removeSub(l),l=this.addObs(this.store.docMetasOfIds$(this.ids).pipe((0,v.U)(p=>p.filter(c=>!!c)),(0,U.b)(300),(0,Z.b)(p=>this.pageList=p)));const{ids:u}=this;u.length>0&&this.documentEffects.readDocMetas_.next({ids:u})}})(),this.ids=[],this.pageList=[]}set pages(e){this.ids=JSON.parse(e),this.subPagesChanged=!0,this.isPanelOpen&&this.onPanelOpen()}delete(e){const n=this.ids.indexOf(e.id);if(-1!==n)return this.ids.splice(n,1),this.subPagesChanged=!0,this.source=`subPage: [${this.ids}]`,void(this.isPanelOpen&&this.onPanelOpen());this.logger.debug("SubPageComponent.delete: id not found")}addToParentById(e,n){e=+e,this.addSub(this.documentEffects.readDocument_.operationStatus$.pipe(M(i=>i.step===A.m7.Complete&&i.trigger.id===e),k(m.j1),(0,v.U)(()=>{const i=this.store.docContent.currentId_.state,o=this.store.getDocContent(e).content;let d=(0,m.Nn)(o);if(d||(d=(0,m.Eq)()),d.subPage||(d.subPage=[]),d.subPage.includes(i))return void this.snackbar.open("parent doc already has this document as a subpage","ok");d.subPage.push(i);const l=this.store.getDocMeta(e);l.subPage=d.subPage;const u=(0,m.$j)(o,d);this.logger.debug(`try to save parent doc content after add this page as subpage of parent doc: ${e}...`),this.documentEffects.saveDocument_.operationStatus$.pipe(M(p=>p.step===A.m7.Success&&p.trigger.id===e),k(m.j1),(0,Z.b)(p=>{this.snackbar.open(`added to page(id: ${e}) as a subpage.`,"ok")})).subscribe(),this.documentEffects.saveDocument_.next({id:e,content:u,format:m.cZ[l.format]})}),(0,G.K)(i=>"TimeoutError"===i.name?(this.logger.error(i),this.snackbar.open("this document not added to parent, because of timeout","ok"),O.E):(this.snackbar.open("this document not added to parent, because error happens","ok"),O.E))));const r=this.store.getDocMeta(e);this.documentEffects.readDocument_.next({id:e,format:r?.format})}addId(e,n){this.ids.includes(e=+e)?this.snackbar.open(`id ${e} already included`,"ok"):(this.ids.push(e),this.subPagesChanged=!0,this.source=`subPage: [${this.ids}]`,n&&(n.value=null))}addToParentBySearch(){this.searchDoc().subscribe(e=>this.addToParentById(e))}addIdBySearch(){this.searchDoc().subscribe(e=>this.addId(e))}searchDoc(){return this.dialog.open(h,{width:"95vw",height:"90vh"}).afterClosed().pipe((0,v.U)(n=>n?.id),(0,L.h)(n=>!!n))}onShowDoc(e){this.router.navigate(["/doc"],{queryParams:{id:e.id,title:e.title,f:e.format||"md"}})}}f.\u0275fac=function(e){return new(e||f)(t.Y36(R.F0),t.Y36(V.G),t.Y36(Q.CL),t.Y36(W.d),t.Y36(I.uw),t.Y36(_.ux))},f.\u0275cmp=t.Xpm({type:f,selectors:[["i-subpage"]],inputs:{pages:"pages"},features:[t.qOj],decls:33,vars:3,consts:[[2,"background-color","transparent","box-shadow","none",3,"opened","closed"],[1,"action-group",3,"click"],["mat-button","","aria-label","add this page as subpage","title","add this page as a subpage to another page",2,"background-color","transparent",3,"matMenuTriggerFor"],[2,"color","#000a"],["menu","matMenu"],[1,"id-input-group",2,"height","auto","border","none",3,"click"],["placeholder","parent page id","matInput","","type","number",1,"id-input",2,"width","auto","margin-left","0.8rem",3,"keydown.Enter","keyup.Enter"],["input",""],["matSuffix","","mat-button","","aria-label","add with parent page id",3,"click"],["mat-menu-item","",3,"click"],[1,"id-input-group"],["placeholder","add by id","matInput","","type","number",1,"id-input",3,"keydown.Enter","keyup.Enter"],["matSuffix","","mat-icon-button","","aria-label","add id",3,"click"],["title","add subpage by searching","mat-button","",3,"click"],[1,"card-container"],["class","docs-card",4,"ngFor","ngForOf"],[1,"docs-card"],[1,"card-body",3,"click"],[1,"doc-id"],[1,"meta-version-date","card-footer"],["mat-button","",1,"delete-button",3,"click"],["class","meta-version",4,"ngIf"],[1,"meta-date",2,"margin-left","10px"],[1,"meta-version"]],template:function(e,n){if(1&e){const r=t.EpF();t.TgZ(0,"mat-expansion-panel",0),t.NdJ("opened",function(){return n.onPanelOpen()})("closed",function(){return n.isPanelOpen=!1}),t.TgZ(1,"mat-expansion-panel-header")(2,"mat-panel-title"),t._uU(3),t.qZA(),t.TgZ(4,"div",1),t.NdJ("click",function(o){return o.stopImmediatePropagation()}),t.TgZ(5,"button",2)(6,"mat-icon",3),t._uU(7,"dashboard_customize"),t.qZA(),t._uU(8,"add as subpage "),t.qZA(),t.TgZ(9,"mat-menu",null,4)(11,"div",5),t.NdJ("click",function(o){return o.stopImmediatePropagation()}),t.TgZ(12,"input",6,7),t.NdJ("keydown.Enter",function(o){return o.stopPropagation()})("keyup.Enter",function(){t.CHM(r);const o=t.MAs(13);return t.KtG(n.addToParentById(o.value,o))}),t.qZA(),t.TgZ(14,"button",8),t.NdJ("click",function(){t.CHM(r);const o=t.MAs(13);return t.KtG(n.addToParentById(o.value,o))}),t.TgZ(15,"mat-icon"),t._uU(16,"add"),t.qZA()()(),t.TgZ(17,"button",9),t.NdJ("click",function(){return n.addToParentBySearch()}),t.TgZ(18,"mat-icon"),t._uU(19,"saved_search"),t.qZA(),t.TgZ(20,"span"),t._uU(21,"search parent page"),t.qZA()()(),t.TgZ(22,"div",10)(23,"input",11,7),t.NdJ("keydown.Enter",function(o){return o.stopPropagation()})("keyup.Enter",function(){t.CHM(r);const o=t.MAs(13);return t.KtG(n.addId(o.value,o))}),t.qZA(),t.TgZ(25,"button",12),t.NdJ("click",function(){t.CHM(r);const o=t.MAs(13);return t.KtG(n.addId(o.value,o))}),t.TgZ(26,"mat-icon",3),t._uU(27,"add"),t.qZA()()(),t.TgZ(28,"button",13),t.NdJ("click",function(){return n.addIdBySearch()}),t.TgZ(29,"mat-icon",3),t._uU(30," zoom_in "),t.qZA()()()(),t.TgZ(31,"div",14),t.YNc(32,ot,15,6,"div",15),t.qZA()()}if(2&e){const r=t.MAs(10);t.xp6(3),t.hij(" Subpages(",n.ids.length,") "),t.xp6(2),t.Q6J("matMenuTriggerFor",r),t.xp6(27),t.Q6J("ngForOf",n.pageList)}},dependencies:[b.sg,b.O5,q.Hw,P.VK,P.OP,P.p6,D.lW,D.RK,tt.Nt,et.R9,C.ib,C.yz,C.yK],styles:[".doc-id[_ngcontent-%COMP%]{position:absolute;right:1.2rem;font-size:small;top:1rem;color:gray}input[_ngcontent-%COMP%]::-webkit-outer-spin-button, input[_ngcontent-%COMP%]::-webkit-inner-spin-button{-webkit-appearance:none;margin:0}input[type=number][_ngcontent-%COMP%]{-moz-appearance:textfield}.id-input-group[_ngcontent-%COMP%]{display:flex;border:lightgray solid .1rem;padding-left:1rem;font-size:medium;height:3rem;align-items:center}.action-group[_ngcontent-%COMP%]{display:flex;align-items:center;column-gap:1rem;margin-right:1rem}.id-input[_ngcontent-%COMP%]{width:6.5rem;margin-top:.02rem;font:inherit;background:transparent;color:currentColor;border:none;outline:none;padding:0;margin:0;vertical-align:bottom;text-align:inherit;box-sizing:content-box}mat-icon[_ngcontent-%COMP%]{font-size:initial!important;height:initial!important;width:initial!important}"]});var at=a(7217),it=a(3346);class g{constructor(){this.customElementComponent=f}}g.\u0275fac=function(e){return new(e||g)},g.\u0275mod=t.oAB({type:g}),g.\u0275inj=t.cJS({imports:[b.ez,it.B,at.t]})}}]);