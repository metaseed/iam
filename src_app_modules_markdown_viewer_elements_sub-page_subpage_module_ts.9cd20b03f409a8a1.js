"use strict";(self.webpackChunkiam=self.webpackChunkiam||[]).push([["src_app_modules_markdown_viewer_elements_sub-page_subpage_module_ts"],{8936:(rt,C,i)=>{i.r(C),i.d(C,{SubPageModule:()=>it});var h=i(6903),p=i(5624),f=i(6681),A=i(3550),T=i(2518),S=i(8733),y=i(9592);function Z(n,r){return(0,S.e)(function(n,r,e){return(u,a)=>{let s=0;u.subscribe(new y.Q(a,c=>{const l=s++;n.call(r,c,l,u)&&(a.next(c),a.complete())},()=>{a.next(void 0),a.complete()}))}}(n,r))}var N=i(7634),J=i(3369),U=i(4402),F=i(5992),$=i(3826);const B=(0,F.d)(n=>function(e=null){n(this),this.message="Timeout has occurred",this.name="TimeoutError",this.info=e});function x(n,r){const{first:e,each:o,with:u=z,scheduler:a=r??N.z,meta:s=null}=(0,J.q)(n)?{first:n}:"number"==typeof n?{each:n}:n;if(null==e&&null==o)throw new TypeError("No timeout provided.");return(0,S.e)((c,l)=>{let m,d,g=null,O=0;const I=P=>{d=(0,$.f)(l,a,()=>{try{m.unsubscribe(),(0,U.Xf)(u({meta:s,lastValue:g,seen:O})).subscribe(l)}catch(st){l.error(st)}},P)};m=c.subscribe(new y.Q(l,P=>{null==d||d.unsubscribe(),O++,l.next(g=P),o>0&&I(o)},void 0,void 0,()=>{(null==d?void 0:d.closed)||null==d||d.unsubscribe(),g=null})),I(null!=e?"number"==typeof e?e:+e-a.now():o)})}function z(n){throw new B(n)}var Y=i(6084),H=i(6122),E=i(6456),j=i(6145),L=i(6251),t=i(8079),M=i(1935),Q=i(1180);let w=(()=>{class n{constructor(e){this.dialog=e}onClick(e){this.dialog.close(e)}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(M.so))},n.\u0275cmp=t.Xpm({type:n,selectors:[["subpage-id-search"]],decls:1,vars:0,consts:[[3,"onClick"]],template:function(e,o){1&e&&(t.TgZ(0,"doc-search-list",0),t.NdJ("onClick",function(a){return o.onClick(a)}),t.qZA())},directives:[Q.I],encapsulation:2}),n})();var k=i(9597),K=i(4060),X=i(3863),V=i(8513),G=i(7826),b=i(5682),R=i(3860),v=i(9819),W=i(7394),_=i(6134),q=i(7733);function tt(n,r){if(1&n&&(t.TgZ(0,"span",23),t._uU(1),t.qZA()),2&n){const e=t.oxw().$implicit;t.xp6(1),t.hij(" v",e.version," ")}}function et(n,r){if(1&n){const e=t.EpF();t.TgZ(0,"div",16)(1,"div",17),t.NdJ("click",function(){const a=t.CHM(e).$implicit;return t.oxw().onShowDoc(a)}),t.TgZ(2,"section"),t._uU(3),t.qZA(),t.TgZ(4,"span",18),t._uU(5),t.qZA(),t.TgZ(6,"p"),t._uU(7),t.qZA()(),t.TgZ(8,"p",19)(9,"button",20),t.NdJ("click",function(){const a=t.CHM(e).$implicit;return t.oxw().delete(a)}),t.TgZ(10,"mat-icon"),t._uU(11,"delete_forever"),t.qZA()(),t.YNc(12,tt,2,1,"span",21),t.TgZ(13,"span",22),t._uU(14),t.qZA()()()}if(2&n){const e=r.$implicit;t.xp6(3),t.Oqu(e.title),t.xp6(2),t.Oqu(e.id),t.xp6(2),t.Oqu(e.summary),t.xp6(5),t.Q6J("ngIf",e.version),t.xp6(2),t.AsE("",null==e.createDate?null:e.createDate.toLocaleDateString()," - ",e.updateDate.toLocaleDateString(),"")}}let nt=(()=>{class n extends((0,p.P2)(j.z)){constructor(e,o,u,a,s,c){super(o,a),this.router=e,this.store=o,this.documentEffects=u,this.dialog=s,this.snackbar=c,this.isPanelOpen=!1,this.subPagesChanged=!1,this.onPanelOpen=(()=>{let l;return()=>{if(this.isPanelOpen=!0,!this.subPagesChanged)return;this.subPagesChanged=!1,this.removeSub(l),l=this.addObs(this.store.docMetasOfIds$(this.ids).pipe((0,f.U)(d=>d.filter(g=>!!g)),(0,A.b)(300),(0,T.b)(d=>this.pageList=d)));const{ids:m}=this;m.length>0&&this.documentEffects.readDocMetas_.next({ids:m})}})(),this.ids=[],this.pageList=[]}set pages(e){this.ids=JSON.parse(e),this.subPagesChanged=!0,this.isPanelOpen&&this.onPanelOpen()}delete(e){const o=this.ids.indexOf(e.id);if(-1!==o)return this.ids.splice(o,1),this.subPagesChanged=!0,this.source=`subPage: [${this.ids}]`,void(this.isPanelOpen&&this.onPanelOpen());this.logger.debug("SubPageComponent.delete: id not found")}addToParentById(e,o){e=+e,this.addSub(this.documentEffects.readDocument_.operationStatus$.pipe(Z(a=>a.step===k.m7.Complete&&a.trigger.id===e),x(p.j1),(0,f.U)(()=>{const a=this.store.docContent.currentId_.state,s=this.store.getDocContent(e).content;let c=(0,p.Nn)(s);if(c||(c=(0,p.Eq)()),c.subPage||(c.subPage=[]),c.subPage.includes(a))return void this.snackbar.open("parent doc already has this document as a subpage","ok");c.subPage.push(a);const l=this.store.getDocMeta(e);l.subPage=c.subPage;const m=(0,p.$j)(s,c);this.logger.debug(`try to save parent doc content after add this page as subpage of parent doc: ${e}...`),this.documentEffects.saveDocument_.operationStatus$.pipe(Z(d=>d.step===k.m7.Success&&d.trigger.id===e),x(p.j1),(0,T.b)(d=>{this.snackbar.open(`added to page(id: ${e}) as a subpage.`,"ok")})).subscribe(),this.documentEffects.saveDocument_.next({id:e,content:m,format:p.cZ[l.format]})}),(0,Y.K)(a=>"TimeoutError"===a.name?(this.logger.error(a),this.snackbar.open("this document not added to parent, because of timeout","ok"),E.E):(this.snackbar.open("this document not added to parent, because error happens","ok"),E.E))));const u=this.store.getDocMeta(e);this.documentEffects.readDocument_.next({id:e,format:u?.format})}addId(e,o){this.ids.includes(e=+e)?this.snackbar.open(`id ${e} already included`,"ok"):(this.ids.push(e),this.subPagesChanged=!0,this.source=`subPage: [${this.ids}]`,o&&(o.value=null))}addToParentBySearch(){this.searchDoc().subscribe(e=>this.addToParentById(e))}addIdBySearch(){this.searchDoc().subscribe(e=>this.addId(e))}searchDoc(){return this.dialog.open(w,{width:"95vw",height:"90vh"}).afterClosed().pipe((0,f.U)(o=>o?.id),(0,H.h)(o=>!!o))}onShowDoc(e){this.router.navigate(["/doc"],{queryParams:{id:e.id,title:e.title,f:e.format||"md"}})}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(K.F0),t.Y36(X.G),t.Y36(L.CL),t.Y36(V.d),t.Y36(M.uw),t.Y36(G.ux))},n.\u0275cmp=t.Xpm({type:n,selectors:[["i-subpage"]],inputs:{pages:"pages"},features:[t.qOj],decls:33,vars:3,consts:[[2,"background-color","transparent","box-shadow","none",3,"opened","closed"],[1,"action-group",3,"click"],["mat-button","","aria-label","add this page as subpage","title","add this page as a subpage to another page",2,"background-color","transparent",3,"matMenuTriggerFor"],[2,"color","#000a"],["menu","matMenu"],[1,"id-input-group",2,"height","auto","border","none",3,"click"],["placeholder","parent page id","matInput","","type","number",1,"id-input",2,"width","auto","margin-left","0.8rem",3,"keydown.Enter","keyup.Enter"],["input",""],["matSuffix","","mat-button","","aria-label","add with parent page id",3,"click"],["mat-menu-item","",3,"click"],[1,"id-input-group"],["placeholder","add by id","matInput","","type","number",1,"id-input",3,"keydown.Enter","keyup.Enter"],["matSuffix","","mat-icon-button","","aria-label","add id",3,"click"],["title","add subpage by searching","mat-button","",3,"click"],[1,"card-container"],["class","docs-card",4,"ngFor","ngForOf"],[1,"docs-card"],[1,"card-body",3,"click"],[1,"doc-id"],[1,"meta-version-date","card-footer"],["mat-button","",1,"delete-button",3,"click"],["class","meta-version",4,"ngIf"],[1,"meta-date",2,"margin-left","10px"],[1,"meta-version"]],template:function(e,o){if(1&e){const u=t.EpF();t.TgZ(0,"mat-expansion-panel",0),t.NdJ("opened",function(){return o.onPanelOpen()})("closed",function(){return o.isPanelOpen=!1}),t.TgZ(1,"mat-expansion-panel-header")(2,"mat-panel-title"),t._uU(3),t.qZA(),t.TgZ(4,"div",1),t.NdJ("click",function(s){return s.stopImmediatePropagation()}),t.TgZ(5,"button",2)(6,"mat-icon",3),t._uU(7,"dashboard_customize"),t.qZA(),t._uU(8,"add as subpage "),t.qZA(),t.TgZ(9,"mat-menu",null,4)(11,"div",5),t.NdJ("click",function(s){return s.stopImmediatePropagation()}),t.TgZ(12,"input",6,7),t.NdJ("keydown.Enter",function(s){return s.stopPropagation()})("keyup.Enter",function(){t.CHM(u);const s=t.MAs(13);return o.addToParentById(s.value,s)}),t.qZA(),t.TgZ(14,"button",8),t.NdJ("click",function(){t.CHM(u);const s=t.MAs(13);return o.addToParentById(s.value,s)}),t.TgZ(15,"mat-icon"),t._uU(16,"add"),t.qZA()()(),t.TgZ(17,"button",9),t.NdJ("click",function(){return o.addToParentBySearch()}),t.TgZ(18,"mat-icon"),t._uU(19,"saved_search"),t.qZA(),t.TgZ(20,"span"),t._uU(21,"search parent page"),t.qZA()()(),t.TgZ(22,"div",10)(23,"input",11,7),t.NdJ("keydown.Enter",function(s){return s.stopPropagation()})("keyup.Enter",function(){t.CHM(u);const s=t.MAs(13);return o.addId(s.value,s)}),t.qZA(),t.TgZ(25,"button",12),t.NdJ("click",function(){t.CHM(u);const s=t.MAs(13);return o.addId(s.value,s)}),t.TgZ(26,"mat-icon",3),t._uU(27,"add"),t.qZA()()(),t.TgZ(28,"button",13),t.NdJ("click",function(){return o.addIdBySearch()}),t.TgZ(29,"mat-icon",3),t._uU(30," zoom_in "),t.qZA()()()(),t.TgZ(31,"div",14),t.YNc(32,et,15,6,"div",15),t.qZA()()}if(2&e){const u=t.MAs(10);t.xp6(3),t.hij(" Subpages(",o.ids.length,") "),t.xp6(2),t.Q6J("matMenuTriggerFor",u),t.xp6(27),t.Q6J("ngForOf",o.pageList)}},directives:[b.ib,b.yz,b.yK,R.lW,v.p6,W.Hw,v.VK,_.Nt,q.R9,v.OP,h.sg,h.O5],styles:[".doc-id[_ngcontent-%COMP%]{position:absolute;right:1.2rem;font-size:small;top:1rem;color:gray}input[_ngcontent-%COMP%]::-webkit-outer-spin-button, input[_ngcontent-%COMP%]::-webkit-inner-spin-button{-webkit-appearance:none;margin:0}input[type=number][_ngcontent-%COMP%]{-moz-appearance:textfield}.id-input-group[_ngcontent-%COMP%]{display:flex;border:lightgray solid .1rem;padding-left:1rem;font-size:medium;height:3rem;align-items:center}.action-group[_ngcontent-%COMP%]{display:flex;align-items:center;grid-column-gap:1rem;column-gap:1rem;margin-right:1rem}.id-input[_ngcontent-%COMP%]{width:6.5rem;margin-top:.02rem}"]}),n})();var ot=i(1677),at=i(3245);let it=(()=>{class n{constructor(){this.customElementComponent=nt}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[[h.ez,at.B,ot.t]]}),n})()}}]);