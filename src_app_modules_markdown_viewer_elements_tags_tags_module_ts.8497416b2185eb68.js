"use strict";(self.webpackChunkiam=self.webpackChunkiam||[]).push([["src_app_modules_markdown_viewer_elements_tags_tags_module_ts"],{4353:(D,f,i)=>{i.r(f),i.d(f,{TagsModule:()=>g});var C=i(7011),T=i(2070),_=i(4196),u=i(6480),M=i(6109),v=i(504),h=i(2538),P=i(1936),p=i(9413),y=i(7022),t=i(5281),I=i(3746),b=i(7938),x=i(1956),L=i(2785),F=i(7831),O=i(4030),R=i(5391),A=i(4785),Z=i(151),m=i(4107);const k=["tagInput"],J=["autoCompleteTrigger"];function w(l,o){if(1&l){const e=t.EpF();t.TgZ(0,"mat-chip-row",11),t.NdJ("click",function(a){const s=t.CHM(e).$implicit,r=t.oxw();return t.KtG(r.onShowTagsCloud(a,s))})("removed",function(){const d=t.CHM(e).$implicit,s=t.oxw();return t.KtG(s.remove(d))}),t._uU(1),t.TgZ(2,"button",12)(3,"mat-icon"),t._uU(4,"cancel"),t.qZA()()()}if(2&l){const e=o.$implicit,n=t.oxw();let a;t.Udp("color","#"+e.color)("background-color","#"+e.color+"22")("border","1px solid #"+e.color),t.Q6J("title",null!==(a=e.description)&&void 0!==a?a:e.name)("removable",n.removable),t.xp6(1),t.hij(" ",e.name," ")}}function B(l,o){if(1&l&&(t.TgZ(0,"mat-option",13),t._uU(1),t.qZA()),2&l){const e=o.$implicit;t.Q6J("value",e),t.xp6(1),t.hij(" ",e.name," ")}}class c extends _.z{constructor(o,e,n,a,d){super(o,n),this.store=o,this.dialog=e,this.snackBar=a,this.tagService=d,this.removable=!0,this.addOnBlur=!1,this.tagInputFormControl=new p.p4,this.separatorKeysCodes=[T.K5,T.OC],this._modifyTags=new M.x,this._filteredRepoTags=[],this._modifyTags.pipe((0,v.b)(1800),(0,h.b)(s=>this.source=`tag: [${s.filter(r=>r).map(r=>r.name).join(",")}]`)).subscribe(),o.tags.values$.pipe((0,P.g)(0)).subscribe(s=>{this.allRepoTags=s,this.filteredRepoTags=s}),this.tagInputFormControl.valueChanges.pipe((0,h.b)(s=>{if(!s||"string"!=typeof s)return;const r=s.toLocaleLowerCase();this.allRepoTags&&(this.filteredRepoTags=this.allRepoTags.filter(E=>E.name.toLocaleLowerCase().includes(r)))}),(0,v.b)(1e3),(0,h.b)(s=>{0===this._filteredRepoTags.length&&this.snackBar.open(`can not find tag: ${s}`,"ok")})).subscribe()}get filteredRepoTags(){return this._filteredRepoTags}set filteredRepoTags(o){this._filteredRepoTags=o?.filter(e=>!this.tagList?.some(n=>n.name===e.name))??[]}set tags(o){this.tagList=[],o.split(",").map(e=>e.trim()).filter(e=>""!==e).forEach(e=>this.store.tags.getById(e).then(n=>{this.tagList.push(n||{name:e})}))}onShowTagsCloud(o,e=null){o.stopImmediatePropagation(),this.dialog.open(y.o,{data:e,height:"100%"})}remove(o){const e=this.tagList.findIndex(n=>n.name===o.name);e>=0&&(this.tagList.splice(e,1),this._modifyTags.next(this.tagList))}drop(o){(0,u.bA)(this.tagList,o.previousIndex,o.currentIndex),this._modifyTags.next(this.tagList)}displayFn(o){return o&&o.name?o.name:""}selected(o){const e=o.option.viewValue.trim();this.tagList.some(n=>n.name===e)?(this.filteredRepoTags=this.allRepoTags,this.autoPanel.openPanel(),this.snackBar.open(`tag ${e} already exist.`,"ok")):this.store.tags.getById(e).then(n=>{n&&(this.tagList.push(n),this._modifyTags.next(this.tagList))}),this.tagInput.nativeElement.value="",this.tagInputFormControl.setValue(null)}onInputEnd(o){const e=(o.value||"").trim();if(e&&!this.allRepoTags.some(n=>n.name===e))return this.snackBar.open(`tag ${e} does not exist, please select from tags list`,"ok"),this.tagInput.nativeElement.value="",this.filteredRepoTags=this.allRepoTags,void this.autoPanel.openPanel()}onTagInputFocus(){this.tagInputFormControl.touched||(this.tagService.getAllTags.next(void 0),this.autoPanel.openPanel())}}c.\u0275fac=function(o){return new(o||c)(t.Y36(I.G),t.Y36(b.uw),t.Y36(x.d),t.Y36(L.ux),t.Y36(F.u))},c.\u0275cmp=t.Xpm({type:c,selectors:[["i-tag"]],viewQuery:function(o,e){if(1&o&&(t.Gf(k,5),t.Gf(J,5)),2&o){let n;t.iGM(n=t.CRH())&&(e.tagInput=n.first),t.iGM(n=t.CRH())&&(e.autoPanel=n.first)}},inputs:{tags:"tags"},features:[t.qOj],decls:16,vars:8,consts:[["appearance","outline",1,"tags-list"],[1,"label",3,"click"],[2,"width","auto","height","auto"],["aria-label","tags","cdkDropList","","cdkDropListOrientation","horizontal",3,"cdkDropListDropped"],["chipList",""],["class","tag","cdkDrag","",3,"color","background-color","border","title","removable","click","removed",4,"ngFor","ngForOf"],["placeholder","add tag...",3,"formControl","matAutocomplete","matChipInputFor","matChipInputSeparatorKeyCodes","matChipInputAddOnBlur","focus","matChipInputTokenEnd"],["autoCompleteTrigger","matAutocompleteTrigger","tagInput",""],["autoActiveFirstOption","",3,"displayWith","optionSelected"],["auto","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],["cdkDrag","",1,"tag",3,"title","removable","click","removed"],["matChipRemove","","title","delete this tag",1,"hide-button"],[3,"value"]],template:function(o,e){if(1&o&&(t.TgZ(0,"mat-form-field",0)(1,"label",1),t.NdJ("click",function(a){return e.onShowTagsCloud(a)}),t.TgZ(2,"span"),t._uU(3,"tags"),t.qZA(),t.TgZ(4,"mat-icon",2),t._uU(5,"open_in_new"),t.qZA(),t._uU(6,":"),t.qZA(),t.TgZ(7,"mat-chip-grid",3,4),t.NdJ("cdkDropListDropped",function(a){return e.drop(a)}),t.YNc(9,w,5,9,"mat-chip-row",5),t.TgZ(10,"input",6,7),t.NdJ("focus",function(){return e.onTagInputFocus()})("matChipInputTokenEnd",function(a){return e.onInputEnd(a)}),t.qZA()(),t.TgZ(13,"mat-autocomplete",8,9),t.NdJ("optionSelected",function(a){return e.selected(a)}),t.YNc(15,B,2,2,"mat-option",10),t.qZA()()),2&o){const n=t.MAs(8),a=t.MAs(14);t.xp6(9),t.Q6J("ngForOf",e.tagList),t.xp6(1),t.Q6J("formControl",e.tagInputFormControl)("matAutocomplete",a)("matChipInputFor",n)("matChipInputSeparatorKeyCodes",e.separatorKeysCodes)("matChipInputAddOnBlur",e.addOnBlur),t.xp6(3),t.Q6J("displayWith",e.displayFn),t.xp6(2),t.Q6J("ngForOf",e.filteredRepoTags)}},dependencies:[C.sg,O.XC,R.ey,O.ZL,A.Hw,Z.KE,m.RA,m.oH,m.qH,m.z3,u.Wj,u.Zt,p.Fj,p.JJ,p.oH],styles:[".tags-list[_ngcontent-%COMP%]{width:100%}.tags-list[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{display:inline-flex;pointer-events:auto;position:absolute;top:0;color:#0009;font-size:small;cursor:pointer;line-height:1.5rem}.tags-list[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:small}.tags-list[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]:hover{color:#00f}.tags-list[_ngcontent-%COMP%]   .tag[_ngcontent-%COMP%]{font-size:1.4rem;-webkit-text-stroke:.08px black}.tags-list[_ngcontent-%COMP%]   .tag.cdk-drop-list-dragging[_ngcontent-%COMP%]{transition:transform .25s cubic-bezier(0,0,.2,1)}.tags-list[_ngcontent-%COMP%]   .tag[_ngcontent-%COMP%]:hover   .hide-button[_ngcontent-%COMP%]{visibility:visible}.tags-list[_ngcontent-%COMP%]   .tag[_ngcontent-%COMP%]   .hide-button[_ngcontent-%COMP%]{visibility:collapse}.tags-list[_ngcontent-%COMP%]   .cdk-drag-animating[_ngcontent-%COMP%]{transition:transform .25s cubic-bezier(0,0,.2,1)}[_nghost-%COMP%]     .mdc-evolution-chip__text-label{color:inherit!important}[_nghost-%COMP%]     .mat-mdc-form-field{margin-bottom:-4rem}[_nghost-%COMP%]     .mat-mdc-form-field .mat-mdc-text-field-wrapper{padding:0;height:initial}[_nghost-%COMP%]     .mat-mdc-form-field .mat-mdc-text-field-wrapper .mdc-notched-outline__leading, [_nghost-%COMP%]     .mat-mdc-form-field .mat-mdc-text-field-wrapper .mdc-notched-outline__notch, [_nghost-%COMP%]     .mat-mdc-form-field .mat-mdc-text-field-wrapper .mdc-notched-outline__trailing{border-style:none}"]});var S=i(3346);class g{constructor(){this.customElementComponent=c}}g.\u0275fac=function(o){return new(o||g)},g.\u0275mod=t.oAB({type:g}),g.\u0275inj=t.cJS({imports:[C.ez,S.B,p.UX]})}}]);